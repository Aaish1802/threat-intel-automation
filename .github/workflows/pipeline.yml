import streamlit as st
import sqlite3
import pandas as pd
import plotly.express as px
import os

st.set_page_config(page_title="Threat Intelligence Dashboard", layout="wide")

# Debug: list files to confirm the database is available
st.write("üìÇ Files in current directory:", os.listdir())

st.title("üìä Threat Intelligence Dashboard")

try:
    # Connect to the SQLite database
    conn = sqlite3.connect("threat_feeds.db")
    cursor = conn.cursor()

    # Execute SQL query
    query = "SELECT * FROM Classified_threats"
    cursor.execute(query)
    data = cursor.fetchall()

    # Get column names
    columns = [description[0] for description in cursor.description]

    # Convert to DataFrame
    df = pd.DataFrame(data, columns=columns)

    # Display data table
    st.dataframe(df)

    # Optional: Display chart
    if 'threat_type' in df.columns:
        fig = px.histogram(df, x='threat_type', title='Threat Distribution by Type')
        st.plotly_chart(fig)
    else:
        st.warning("‚ö†Ô∏è 'threat_type' column not found. Chart not generated.")

except Exception as e:
    st.error(f"‚ùå Error loading data: {e}")
